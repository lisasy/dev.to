<% json_data = notification.json_data %>
<% user = User.find_by(id: json_data["user"]["id"]) %>
<% cache "broadcast-html-#{notification.json_data['broadcast']['title']}" do %>
  <a href="<%= json_data["user"]["path"] %>">
    <figure class="crayons-avatar crayons-avatar--xl mr-2">
      <img class="crayons-avatar__image" src="<%= ProfileImage.new(user).get %>"
      alt="link to <%= json_data["user"]["username"] %>'s profile" />
    </figure>
  </a>
  <div class="content notification-content broadcast-content" id="<%= sanitized_broadcast_id(json_data['broadcast']['title']) %>">
    <%= json_data["broadcast"]["processed_html"].html_safe %>

    <% if notification.json_data['broadcast']['type_of'] == "Welcome" %>
      <div class="opt-out"><a href="<%= user_settings_path(tab: :notifications) %>">Go to your settings to manage your notification settings.</a></div>
    <% end %>
  </div>
<% end %>
